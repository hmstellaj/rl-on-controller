# ğŸš€ Tank Navigation with Reinforcement Learning

Unity ì‹œë®¬ë ˆì´í„° ê¸°ë°˜ ì „ì°¨ ììœ¨ì£¼í–‰ ì‹œìŠ¤í…œ  
**A* ê²½ë¡œ ê³„íš + RL êµ­ì†Œ ì œì–´** í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
tank_rl/
â”œâ”€â”€ rl_environment.py    # Gymnasium í™˜ê²½ (í•™ìŠµìš©)
â”œâ”€â”€ rl_controller.py     # RL ì»¨íŠ¸ë¡¤ëŸ¬ (ì¶”ë¡ ìš©)
â”œâ”€â”€ train_rl.py          # í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ server_rl.py         # Flask ì„œë²„ (ì‹œë®¬ë ˆì´í„° ì—°ë™)
â”œâ”€â”€ ob_v2.json           # ì¥ì• ë¬¼ ë°ì´í„°
â”œâ”€â”€ height_map.npy       # ë†’ì´ ë§µ
â”œâ”€â”€ slope_costmap.npy    # ê²½ì‚¬ë„ ë§µ
â””â”€â”€ models/              # í•™ìŠµëœ ëª¨ë¸ ì €ì¥ ìœ„ì¹˜
    â””â”€â”€ tank_nav_final.zip
```

---

## ğŸ› ï¸ ì„¤ì¹˜

```bash
# í•„ìˆ˜ íŒ¨í‚¤ì§€
pip install flask numpy gymnasium stable-baselines3 matplotlib

# (ì„ íƒ) ë³‘ë ¬ í•™ìŠµìš©
pip install stable-baselines3[extra]
```

---

## ğŸ® ì‚¬ìš© ë°©ë²•

### 1ï¸âƒ£ í•™ìŠµ (ë¡œì»¬, ì‹œë®¬ë ˆì´í„° ì—†ì´)

```bash
# ê¸°ë³¸ í•™ìŠµ (500K ìŠ¤í…)
python train_rl.py train --timesteps 500000

# ìƒì„¸ ì˜µì…˜
python train_rl.py train \
    --timesteps 1000000 \
    --n-envs 8 \
    --lr 0.0003 \
    --save-path ./models

# Tensorboardë¡œ ëª¨ë‹ˆí„°ë§
tensorboard --logdir ./tensorboard_logs
```

### 2ï¸âƒ£ í‰ê°€

```bash
# í•™ìŠµëœ ëª¨ë¸ í‰ê°€
python train_rl.py eval --model models/tank_nav_final.zip --episodes 10

# ì‹œê°í™” í¬í•¨
python train_rl.py eval --model models/tank_nav_final.zip --render
```

### 3ï¸âƒ£ ì„œë²„ ì‹¤í–‰ (ì‹œë®¬ë ˆì´í„° ì—°ë™)

```bash
# RL ëª¨ë¸ ì‚¬ìš©
python server_rl.py --model models/tank_nav_final.zip --port 5000

# ëª¨ë¸ ì—†ì´ (ê·œì¹™ ê¸°ë°˜ í´ë°±)
python server_rl.py --port 5000
```

---

## ğŸ§  ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Unity ì‹œë®¬ë ˆì´í„°                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ REST API (~5Hz)
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Flask Server (server_rl.py)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   [A* í”Œë˜ë„ˆ]  â”€â”€waypointsâ”€â”€â–º  [RL ì»¨íŠ¸ë¡¤ëŸ¬]  â”€â”€ëª…ë ¹â”€â”€â–º     â”‚
â”‚       â”‚                            â”‚                        â”‚
â”‚   ì „ì—­ ê²½ë¡œ ìƒì„±              êµ­ì†Œ ì œì–´ ê²°ì •                 â”‚
â”‚   (ì¥ì• ë¬¼ íšŒí”¼)              (ë¶€ë“œëŸ¬ìš´ ì¡°í–¥)                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RL ì—ì´ì „íŠ¸ ì—­í• 

| êµ¬ë¶„ | A* í”Œë˜ë„ˆ | RL ì—ì´ì „íŠ¸ |
|------|-----------|-------------|
| ì—­í•  | ì „ì—­ ê²½ë¡œ ìƒì„± | êµ­ì†Œ ì œì–´ |
| ì…ë ¥ | ì‹œì‘ì , ëª©ì ì§€, ì¥ì• ë¬¼ | í˜„ì¬ ìƒíƒœ, íƒ€ê²Ÿ, ë¼ì´ë‹¤ |
| ì¶œë ¥ | waypoint ë¦¬ìŠ¤íŠ¸ | W/A/D/STOP ëª…ë ¹ |
| íŠ¹ì§• | ìµœì  ê²½ë¡œ ë³´ì¥ | ë¶€ë“œëŸ¬ìš´ ì›€ì§ì„, ìƒí™© ì ì‘ |

---

## ğŸ“Š Observation Space (20ì°¨ì›)

```python
observation = [
    heading_error / 180,      # íƒ€ê²Ÿ ë°©í–¥ ì˜¤ì°¨ (-1 ~ 1)
    target_distance / 50,     # íƒ€ê²Ÿê¹Œì§€ ê±°ë¦¬ (0 ~ 1)
    current_speed / max_speed,# í˜„ì¬ ì†ë„ (0 ~ 1)
    goal_distance / 300,      # ëª©í‘œê¹Œì§€ ê±°ë¦¬ (0 ~ 1)
    lidar_ray_0 / 30,         # ë¼ì´ë‹¤ 0Â° (0 ~ 1)
    lidar_ray_1 / 30,         # ë¼ì´ë‹¤ 22.5Â°
    ...                       # ì´ 16ê°œ ë°©í–¥
    lidar_ray_15 / 30,        # ë¼ì´ë‹¤ 337.5Â°
]
```

---

## ğŸ¯ Action Space (6ê°œ ì´ì‚° í–‰ë™)

| Action | ì„¤ëª… | moveWS | moveAD |
|--------|------|--------|--------|
| 0 | ì§ì§„ (ë¹ ë¦„) | W, 0.5 | - |
| 1 | ì „ì§„ + ì¢ŒíšŒì „ | W, 0.35 | A, 0.5 |
| 2 | ì „ì§„ + ìš°íšŒì „ | W, 0.35 | D, 0.5 |
| 3 | ì œìë¦¬ ì¢ŒíšŒì „ | STOP | A, 0.8 |
| 4 | ì œìë¦¬ ìš°íšŒì „ | STOP | D, 0.8 |
| 5 | ì •ì§€ | STOP | - |

---

## ğŸ† Reward Function

```python
def calculate_reward():
    reward = 0
    
    # 1. ëª©í‘œ ë„ë‹¬ (+1000)
    if reached_goal:
        return 1000
    
    # 2. ì¶©ëŒ (-500)
    if collision:
        return -500
    
    # 3. ëª©í‘œ ì ‘ê·¼ (+10 per meter)
    reward += distance_delta * 10
    
    # 4. ì‹œê°„ íŒ¨ë„í‹° (-0.1 per step)
    reward -= 0.1
    
    # 5. ë°©í–¥ ì •ë ¬ ë³´ë„ˆìŠ¤ (+0.5)
    if abs(heading_error) < 15:
        reward += 0.5
    
    # 6. ì†ë„ ë³´ë„ˆìŠ¤ (+0.3)
    if speed > 1.0:
        reward += 0.3
    
    return reward
```

---

## âš™ï¸ í•˜ì´í¼íŒŒë¼ë¯¸í„°

### í•™ìŠµ ì„¤ì • (train_rl.py)

| íŒŒë¼ë¯¸í„° | ê¸°ë³¸ê°’ | ì„¤ëª… |
|----------|--------|------|
| `--timesteps` | 500,000 | ì´ í•™ìŠµ ìŠ¤í… |
| `--n-envs` | 4 | ë³‘ë ¬ í™˜ê²½ ìˆ˜ |
| `--lr` | 3e-4 | í•™ìŠµë¥  |
| `--batch-size` | 64 | ë°°ì¹˜ í¬ê¸° |
| `--gamma` | 0.99 | í• ì¸ìœ¨ |

### í™˜ê²½ ì„¤ì • (rl_environment.py)

| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… |
|----------|-----|------|
| `goal_threshold` | 8.0m | ëª©í‘œ ë„ë‹¬ íŒì • ê±°ë¦¬ |
| `max_episode_steps` | 1500 | ìµœëŒ€ ì—í”¼ì†Œë“œ ê¸¸ì´ (300ì´ˆ) |
| `lidar_num_rays` | 16 | ê°€ìƒ ë¼ì´ë‹¤ ë ˆì´ ìˆ˜ |
| `lidar_max_range` | 30m | ë¼ì´ë‹¤ ìµœëŒ€ ê±°ë¦¬ |

---

## ğŸ“ˆ ì˜ˆìƒ í•™ìŠµ ê²°ê³¼

```
ì—í”¼ì†Œë“œ 1-500:     ë¬´ì‘ìœ„ íƒí—˜, ì„±ê³µë¥  ~5%
ì—í”¼ì†Œë“œ 500-1500:  ë°©í–¥ í•™ìŠµ, ì„±ê³µë¥  ~30%
ì—í”¼ì†Œë“œ 1500-3000: ì¥ì• ë¬¼ íšŒí”¼ í•™ìŠµ, ì„±ê³µë¥  ~60%
ì—í”¼ì†Œë“œ 3000+:     ìµœì í™”, ì„±ê³µë¥  ~80%+

ì˜ˆìƒ í•™ìŠµ ì‹œê°„: 4-8ì‹œê°„ (4 ë³‘ë ¬ í™˜ê²½, 500K ìŠ¤í…)
```

---

## ğŸ”§ ê¸°ì¡´ ì½”ë“œì™€ í†µí•©

### hybrid_controller.pyì—ì„œ ì‚¬ìš©í•˜ê¸°

```python
from rl_controller import RLController

class HybridController:
    def __init__(self, ...):
        # ê¸°ì¡´ ì½”ë“œ...
        
        # RL ì»¨íŠ¸ë¡¤ëŸ¬ ì¶”ê°€
        self.rl_controller = RLController(
            model_path="models/tank_nav_final.zip"
        )
    
    def _seq13_astar_pid(self, curr_x, curr_z, curr_yaw):
        # ê²½ë¡œê°€ ì—†ìœ¼ë©´ ìƒì„±
        if not self.state.global_path:
            self._generate_astar_path(curr_x, curr_z)
        
        # íƒ€ê²Ÿ í¬ì¸íŠ¸ ì„ íƒ
        target_point, _ = self._select_target_point(curr_x, curr_z)
        
        # RL ì œì–´ (PID ëŒ€ì²´)
        return self.rl_controller.get_action(
            curr_x=curr_x,
            curr_z=curr_z,
            curr_yaw=curr_yaw,
            target=target_point,
            goal=self.state.destination,
        )
```

---

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ëª¨ë¸ì´ ë¡œë“œë˜ì§€ ì•Šì„ ë•Œ
```bash
# stable-baselines3 ì„¤ì¹˜ í™•ì¸
pip install stable-baselines3

# ëª¨ë¸ ê²½ë¡œ í™•ì¸
ls -la models/tank_nav_final.zip
```

### í•™ìŠµì´ ëŠë¦´ ë•Œ
```bash
# ë³‘ë ¬ í™˜ê²½ ìˆ˜ ëŠ˜ë¦¬ê¸°
python train_rl.py train --n-envs 8

# GPU ì‚¬ìš© í™•ì¸ (PyTorch)
python -c "import torch; print(torch.cuda.is_available())"
```

### ì‹œë®¬ë ˆì´í„° ì—°ê²° ì‹¤íŒ¨
```bash
# í¬íŠ¸ í™•ì¸
netstat -an | grep 5000

# ë°©í™”ë²½ í™•ì¸ (Windows)
# Unityì—ì„œ localhost:5000 ìœ¼ë¡œ ì—°ê²° ì„¤ì •
```

---

## ğŸ“ TODO

- [ ] A* í”Œë˜ë„ˆ í†µí•© (astar_planner.py import)
- [ ] ê²½ì‚¬ë„ ê¸°ë°˜ ì†ë„ ì¡°ì ˆ ê°•í™”
- [ ] Stuck ë³µêµ¬ ë¡œì§ ì¶”ê°€
- [ ] ì—°ì† í–‰ë™ ê³µê°„ (Box) ì‹¤í—˜
- [ ] SAC ì•Œê³ ë¦¬ì¦˜ ë¹„êµ ì‹¤í—˜

---

## ğŸ“š ì°¸ê³ 

- [Stable-Baselines3 ë¬¸ì„œ](https://stable-baselines3.readthedocs.io/)
- [Gymnasium ë¬¸ì„œ](https://gymnasium.farama.org/)
- [PPO ë…¼ë¬¸](https://arxiv.org/abs/1707.06347)
